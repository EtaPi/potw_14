# Rakefile

require 'rake'

OPTS = "-Wall -Wextra -Wpedantic -Wstrict-overflow -march=native"
LIBS = ["util", "freq", "stats"];

task default: ["build", "run"]

task :build do
  puts "Building..."
  source = Rake::FileList["**/*.c"].exclude( *cify(LIBS) )

  LIBS.each do |lib|
    `clang #{lib}.c #{OPTS} -c`
  end

  source.each do |s|
    root = File.basename(s, ".*")
    `clang #{s} #{ oify(LIBS).join " " } #{OPTS} -o #{root}`
  end

  print "\n----------------------------------------\n\n"
end

task :run do
  exec( "./c2" )
end

task test: ["build"]
task :test do
  exec( "./runner" )
end

def cify names
  names.map{ |i| i+".c" }
end

def oify names
  names.map{ |i| i+".o" }
end
